<!doctype html><html><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Owner Panel</title>
<link rel="stylesheet" href="style.css"/>
<script src="config.js"></script>
<script src="app.js"></script>
<script src="./common.js"></script>
<script>
  requireRole(['owner']);     // owner only for this page
  renderNav('topNav');        // owner will still see Admin link
</script>
</head><body>
  <div id="topNav"></div>
<div class="container">
  <div class="topbar">
    <a href="admin.html">Go to Admin (test)</a>
    <div><button class="btn-outline" onclick="logout()">Logout</button></div>
  </div>

  <div class="card">
    <h1>Owner â€¢ Add Stock</h1>
    <form id="addStockForm">
      <label>Product</label>
      <select name="product_key" id="productSelect" required></select>

      <label>Account type</label>
      <select name="account_type" required>
        <option value="shared profile">shared profile</option>
        <option value="solo profile">solo profile</option>
        <option value="shared account">shared account</option>
        <option value="solo account">solo account</option>
      </select>

      <label>Duration</label>
      <select name="duration_days" id="durationSelect"></select>

      <label>Quantity</label>
      <input type="number" min="1" name="quantity" value="1"/>

      <label>Email </label>
      <input name="email" placeholder="login email"/>

      <label>Password </label>
      <input name="password" placeholder="login password"/>

      <label>Profile (optional)</label>
      <input name="profile_name" placeholder="profile name"/>

      <label>PIN (optional)</label>
      <input name="pin" placeholder="profile pin"/>

      <label>Notes</label>
      <textarea name="notes" rows="3"></textarea>

      <div style="margin-top:12px"><button>Add stock</button></div>
    </form>
  </div>

  <div class="card">
    <h1>Current Stock (summary)</h1>
    <table>
      <thead><tr><th>Product</th><th>Type</th><th>Qty</th></tr></thead>
      <tbody id="stockTbody"></tbody>
    </table>
  </div>

  <div class="card">
    <h1>Buyer Records (all admins)</h1>
    <table>
      <thead>
        <tr>
          <th>Product</th><th>Type</th><th>Duration</th><th>Created</th>
          <th>Expiry</th><th>Admin</th><th>Buyer</th><th>Price</th><th></th>
        </tr>
      </thead>
      <tbody id="salesTbody"></tbody>
    </table>

    <div style="margin-top:12px" class="row">
      <input id="editSaleId" placeholder="Sale ID to edit"/>
      <input id="editBuyer" placeholder="Buyer social/link"/>
      <input id="editPrice" type="number" step="0.01" placeholder="Price"/>
      <button class="btn-outline" onclick="onOwnerUpdate()">Save buyer info</button>
    </div>
  </div>
</div>

<script>
  const u = requireRole(['owner']);
  const productSelect = document.getElementById('productSelect');
  const durationSelect = document.getElementById('durationSelect');

  loadProducts(productSelect);
  fillDuration(durationSelect);

  document.getElementById('addStockForm').addEventListener('submit', async (e)=>{
    e.preventDefault();
    await ownerAddStock(e.target);
    await loadStockSummary(document.getElementById('stockTbody'));
  });

  async function onOwnerUpdate(){
    const id = document.getElementById('editSaleId').value.trim();
    if(!id){ return alert('Enter Sale ID'); }
    const buyer = document.getElementById('editBuyer').value.trim();
    const price = document.getElementById('editPrice').value.trim();
    await upsertBuyerInfo(id, buyer, price);
    await listSales(document.getElementById('salesTbody'));
  }

  (async ()=>{
    await loadStockSummary(document.getElementById('stockTbody'));
    await listSales(document.getElementById('salesTbody'));
    // enable inline edit shortcut
    document.getElementById('salesTbody').addEventListener('click', (e)=>{
      if(e.target.classList.contains('edit')){
        const id = e.target.closest('tr').querySelector('button').dataset.id;
        document.getElementById('editSaleId').value = id;
      }
    });
  })();
</script>
</body></html>